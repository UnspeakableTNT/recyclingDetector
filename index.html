<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Trash Recognition</title>
    <link rel="stylesheet" href="styles.css" />
    <!-- 1) TensorFlow.js -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.21.0/dist/tf.min.js"></script>
    <!-- 2) Teachable Machine Image bundle -->
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
  </head>
  <body>
    <h1>‚ôªÔ∏è Trash Recognition ‚ôªÔ∏è</h1>
    <div id="error" style="color:#c00;font-weight:bold;"></div>
    <div id="webcam-container"></div>
    <div id="label-container" class="prediction"></div>

    <script>
      const URL = './model/';
      let model, webcam, labelContainer, maxPredictions;

      async function init() {
        try {
          const modelURL    = URL + 'model.json';
          const metadataURL = URL + 'metadata.json';
          console.log('Loading model from', modelURL, 'and metadata from', metadataURL);

          model = await tmImage.load(modelURL, metadataURL);
          maxPredictions = model.getTotalClasses();

          // build out label elements
          labelContainer = document.getElementById('label-container');
          for (let i = 0; i < maxPredictions; i++) {
            const p = document.createElement('div');
            p.classList.add('pred-item');
            labelContainer.appendChild(p);
          }

          // setup webcam
          webcam = new tmImage.Webcam(320, 240, true);
          await webcam.setup();
          await webcam.play();
          document.getElementById('webcam-container').appendChild(webcam.canvas);

          window.requestAnimationFrame(loop);
        } catch (err) {
          console.error('üõë Model load error:', err);
          document.getElementById('error').innerText =
            '‚ùå Failed to load model: ' + err.message;
        }
      }

      async function loop() {
        webcam.update();
        const predictions = await model.predict(webcam.canvas);
        predictions
          .sort((a, b) => b.probability - a.probability)
          .forEach((pred, i) => {
            labelContainer.childNodes[i].innerText =
              `${pred.className}: ${(pred.probability*100).toFixed(1)}%`;
          });
        window.requestAnimationFrame(loop);
      }

      init();
    </script>
  </body>
</html>

